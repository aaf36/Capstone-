<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Report Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
</head>
<body>
    <label for="sectorTypeSelect">Choose a sector:</label>
<select id="sectorTypeSelect">
    <option value="">Select Sector</option>
    {% for value, name in sector_types %}
    <option value="{{ value }}" {% if value == sector_type %}selected{% endif %}>{{ name }}</option>
    {% endfor %}
</select>

<br><br>


    
    <label for="corruptionTypeSelect">نوع الفساد:</label>
    <select id="corruptionTypeSelect">
    {% for value, name in corruption_types %}
    <option value="{{ value }}" {% if value == "احتكار" %}selected{% endif %}>{{ name }}</option>
    {% endfor %}
    <option value="none">كل الانواع</option>
    </select>

    <div id="main" style="width: 600px; height: 400px;"></div>
    <div id="main2" style="width: 1200px; height: 400px;"></div>
    
    <script>
        document.getElementById('sectorTypeSelect').addEventListener('change', function() {
            var sectorType = this.value;
            if (sectorType) {  // Check if a valid sector type is selected
                window.location.href = `/statistics/${sectorType}/`;  // Redirect to the URL
            }
        });


        var sectorType = '{{ sector_type }}'; // in url
        var defaultCorruptionType = 'احتكار'; // Default corruption type
        var option1;
    
        var myChart1 = echarts.init(document.getElementById('main')); // This will display temporal statistics
        var myChart2 = echarts.init(document.getElementById('main2')); // This will display count statistics per corruption type
    
        // loads initial data for the corruption type count chart
        fetch(`/ajax/load_statistics/${sectorType}/?corruption_type=none`)
            .then(response => response.json())
            .then(data => {
                 option1 = {
                    title: { text: 'Temporal Statistics for ' + sectorType.charAt(0).toUpperCase() + sectorType.slice(1) },
                    tooltip: {}, 
                    legend: { data: ['Total'] },
                    xAxis: { type: 'category', data: data.temporal_sector_type_count.map(item => item.year) },
                    yAxis: { type: 'value' },
                    series: [{ type: 'bar', data: data.temporal_sector_type_count.map(item => item.total) }]
                };
    
                var option2 = {
                    title: { text: 'Count Statistics for ' + sectorType +  ' per Corruption Type' },
                    tooltip: {}, 
                    legend: { data: ['Total'] },
                    xAxis: {
                        type: 'category', 
                        data: data.sector_count_per_corruption_type.map(item => item.corruption_type), 
                        axisLabel: { interval: 0, rotate: 45 }
                    },
                    yAxis: { type: 'value' },
                    series: [{ type: 'line', data: data.sector_count_per_corruption_type.map(item => item.total), itemStyle: { color: 'green' } }]
                };
    
                myChart2.setOption(option2);
            })
            .catch(error => console.error('Error loading the data:', error));
    
        // loads the temporal sector type - corruption type chart with default corruption type data 
        fetch(`/ajax/load_statistics/${sectorType}/?corruption_type=${defaultCorruptionType}`)
            .then(response => response.json())
            .then(data => {
                var option3 = {
                    title: { text: 'Temporal Statistics for ' + sectorType + ' per ' + defaultCorruptionType},
                    tooltip: {}, 
                    legend: { data: ['Total'] },
                    xAxis: {
                        type: 'category', 
                        data: data.temporal_sector_type_ct_count.map(item => item.year), 
                        axisLabel: { interval: 0, rotate: 45 }
                    },
                    yAxis: { type: 'value' },
                    series: [{ type: 'bar', data: data.temporal_sector_type_ct_count.map(item => item.total), itemStyle: { color: 'blue' } }]
                };
                myChart1.setOption(option3);
            })
            .catch(error => console.error('Error loading the data:', error));
    
        // changes temporal sector type - corruption data chart based on change in dropdown 
        document.getElementById('corruptionTypeSelect').addEventListener('change', function() {
            var corruptionType = this.value;
            if (corruptionType !== 'none') {
                fetch(`/ajax/load_statistics/${sectorType}/?corruption_type=${corruptionType}`)
                    .then(response => response.json())
                    .then(data => {
                        var option3 = {
                            title: { text: 'Detailed Statistics for ' + sectorType +  ' per ' + corruptionType },
                            tooltip: {}, 
                            legend: { data: ['Total'] },
                            xAxis: {
                                type: 'category', 
                                data: data.temporal_sector_type_ct_count.map(item => item.year), 
                                axisLabel: { interval: 0, rotate: 45 }
                            },
                            yAxis: { type: 'value' },
                            series: [{ type: 'bar', data: data.temporal_sector_type_ct_count.map(item => item.total), itemStyle: { color: 'blue' } }]
                        };
                        myChart1.setOption(option3);
                    })
                    .catch(error => console.error('Error loading the data:', error));
            } else {
                myChart1.setOption(option1);
            }
        });
    </script>
    
    